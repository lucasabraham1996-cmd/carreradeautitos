<!doctype html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torneo de Autitos - Hot Wheels</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        /* Custom styles for the app container */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 0;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- Dependencias obligatorias para que React y Lucide se carguen en orden -->
    <!-- React and ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Lucide Icons CDN -->
    <script src="https://unpkg.com/lucide-react@latest"></script>
    
    <!-- Babel for JSX compilation (Debe ir antes del cÃ³digo de la aplicaciÃ³n) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>


    <script type="text/babel">
        // DesestructuraciÃ³n de React para uso global
        const { useState, useEffect } = window.React || {};
        
        // Componente Icono DinÃ¡mico (Resuelve el error de forwardRef)
        const Icon = ({ name, size = 24, fill = 'none', className = '' }) => {
            const LucideIcon = window.LucideReact ? window.LucideReact[name] : null;
            if (!LucideIcon) {
                // Fallback si el Ã­cono no se encuentra
                return <span className={"inline-block " + className} style={{ width: size, height: size, lineHeight: `${size}px` }}>?</span>;
            }
            // Los Ã­conos de Lucide son componentes React, se usan con createElement
            return React.createElement(LucideIcon, { size, fill, className });
        };


        // --- DATA Y CONSTANTES ---

        const ICON_URLS = {
          RENAULT: "https://cdn-icons-png.flaticon.com/128/16178/16178110.png",
          PEUGEOT: "https://cdn-icons-png.flaticon.com/128/16178/16178107.png",
          VW: "https://cdn-icons-png.flaticon.com/128/16178/16178138.png",
          MERCEDES: "https://cdn-icons-png.flaticon.com/128/16178/16178099.png",
          TOYOTA: "https://cdn-icons-png.flaticon.com/128/16178/16178130.png",
          AUDI: "https://cdn-icons-png.flaticon.com/128/16178/16178142.png",
          CHEVROLET: "https://cdn-icons-png.flaticon.com/128/16178/16178046.png",
          FORD: "https://listcarbrands.com/wp-content/uploads/2016/03/Logo-Ford-1.png", 
          HOT_WHEELS: "https://cdn.freebiesupply.com/logos/large/2x/hot-wheels-5-logo-black-and-white.png",
        };

        const INITIAL_CARS = [
          { id: 1, name: 'Peugeot 206', detail: '(Rojo #1)', color: '#E74C3C', brandIconType: ICON_URLS.PEUGEOT, wins: 0, draws: 0, losses: 0, matches: 0, tier: 3, titles: 0 },
          { id: 2, name: 'Peugeot 206', detail: '(Rojo #2)', color: '#E74C3C', brandIconType: ICON_URLS.PEUGEOT, wins: 0, draws: 0, losses: 0, matches: 0, tier: 3, titles: 0 },
          { id: 3, name: 'Peugeot 107', detail: '(Blanco)', color: '#E0E0E0', brandIconType: ICON_URLS.PEUGEOT, wins: 0, draws: 0, losses: 0, matches: 0, tier: 3, titles: 0 },
          { id: 4, name: 'Mercedes Benz', detail: '(Blanco)', color: '#E0E0E0', brandIconType: ICON_URLS.MERCEDES, wins: 0, draws: 0, losses: 0, matches: 0, tier: 2, titles: 0 }, 
          { id: 5, name: 'Audi TT', detail: '(Rojo)', color: '#CC0000', brandIconType: ICON_URLS.AUDI, wins: 0, draws: 0, losses: 0, matches: 0, tier: 1, titles: 0 }, 
          { id: 6, name: 'Audi TT', detail: '(Negro)', color: '#333333', brandIconType: ICON_URLS.AUDI, wins: 0, draws: 0, losses: 0, matches: 0, tier: 2, titles: 0 },
          { id: 7, name: 'Rayito Police', detail: '(Naranja)', color: '#FF8C00', brandIconType: 'âš¡', wins: 0, draws: 0, losses: 0, matches: 0, tier: 3, titles: 0 },
          { id: 9, name: 'Renault Scenic', detail: '(Verde)', color: '#008000', brandIconType: ICON_URLS.RENAULT, wins: 0, draws: 0, losses: 0, matches: 0, tier: 1, titles: 0 },
          { id: 10, name: 'Toyota', detail: '', color: '#FFD700', brandIconType: ICON_URLS.TOYOTA, wins: 0, draws: 0, losses: 0, matches: 0, tier: 2, titles: 0 },
          { id: 12, name: 'PolicÃ­a', detail: '(Negra)', color: '#333333', brandIconType: 'ðŸš¨', wins: 0, draws: 0, losses: 0, matches: 0, tier: 4, titles: 0 },
          { id: 13, name: 'Ranger', detail: '(Morada)', color: '#800080', brandIconType: ICON_URLS.FORD, wins: 0, draws: 0, losses: 0, matches: 0, tier: 4, titles: 0 },
          { id: 14, name: 'VW Golf', detail: '(Bordo)', color: '#800020', brandIconType: ICON_URLS.VW, wins: 0, draws: 0, losses: 0, matches: 0, tier: 3, titles: 0 },
          { id: 15, name: 'Ford Focus', detail: '(Naranja)', color: '#FF8C00', brandIconType: ICON_URLS.FORD, wins: 0, draws: 0, losses: 0, matches: 0, tier: 2, titles: 0 },
          { id: 16, name: 'Chevrolet Camaro', detail: '(Azul)', color: '#0000FF', brandIconType: ICON_URLS.CHEVROLET, wins: 0, draws: 0, losses: 0, matches: 0, tier: 3, titles: 0 },
          { id: 17, name: 'Chevy', detail: '(Amarilla)', color: '#FFFF00', brandIconType: ICON_URLS.CHEVROLET, wins: 0, draws: 0, losses: 0, matches: 0, tier: 1, titles: 0 },
          { id: 19, name: 'Mercedes Benz', detail: '(Blanco - 2)', color: '#E0E0E0', brandIconType: ICON_URLS.MERCEDES, wins: 0, draws: 0, losses: 0, matches: 0, tier: 2, titles: 0 },
        ];

        function App() {
          
          const [cars, setCars] = useState(INITIAL_CARS.map(c => ({ ...c, titles: c.titles || 0 })));
          const [view, setView] = useState('arena'); 
          const [newCarName, setNewCarName] = useState('');
          const [garageIndex, setGarageIndex] = useState(0); 
          
          // Estado del Juego
          const [gameMode, setGameMode] = useState('free');
          const [schedule, setSchedule] = useState([]); 
          const [currentRoundIndex, setCurrentRoundIndex] = useState(0); 
          const [currentMatchIndexInRound, setCurrentMatchIndexInRound] = useState(0); 
          
          const [duel, setDuel] = useState({ car1: null, car2: null });
          const [winner, setWinner] = useState(null);
          const [isDraw, setIsDraw] = useState(false);
          const [cupChampion, setCupChampion] = useState(null); 

          const isLoading = false; // No hay carga asÃ­ncrona

          // --- HELPERS ---
          const getPoints = (c) => (c.wins * 3) + (c.draws * 1);
          const getFullName = (car) => `${car.name} ${car.detail || ''}`.trim();

          // --- COMPONENTS ---
          const CarBadge = ({ car, size = 'sm' }) => {
            const sizeClasses = size === 'lg' ? 'w-10 h-10 p-2' : size === 'xs' ? 'w-6 h-6 p-0.5' : 'w-8 h-8 p-1'; 
            const isUrl = car?.brandIconType && car.brandIconType.startsWith('http');
            return (
                <div className={`${sizeClasses} rounded-full flex items-center justify-center shadow-md flex-shrink-0 bg-white overflow-hidden`} style={{ borderColor: car.color, borderWidth: size==='xs'?1:2 }}>
                    {isUrl ? <img src={car.brandIconType} className="w-full h-full object-contain" onError={(e) => e.target.style.display='none'} /> : <span className="text-xs font-bold">{car?.brandIconType}</span>}
                </div>
            );
          }

          const BattleBackgroundIcon = ({ car }) => {
            const isUrl = car?.brandIconType && car.brandIconType.startsWith('http');
            if (isUrl) return <img src={car.brandIconType} className="w-40 h-40 object-contain" style={{ filter: 'grayscale(100%) brightness(200%)' }} />;
            return <span className="text-[120px] text-white opacity-100">{car?.brandIconType || '?'}</span>;
          };
          
          const StyledTableRow = ({ car, children }) => {
              const cellBgColor = 'rgba(255, 255, 255, 0.7)';
              const cells = React.Children.toArray(children).map((child, index) => {
                  let finalProps = { className: (child.props.className || '') + ' relative z-10', style: { ...child.props.style, backgroundColor: cellBgColor } };
                  if (index === 1) { 
                      return React.cloneElement(child, {
                          ...finalProps,
                          className: (child.props.className || '') + ' relative z-10 overflow-hidden',
                          style: { ...finalProps.style, backgroundImage: `linear-gradient(to right, ${car.color}4D, transparent)` },
                          children: (
                              <div className="relative z-20 h-full flex items-center">
                                  <div style={{ position: 'absolute', top: '50%', left: '10%', transform: 'translateY(-50%) scale(0.6)', opacity: 0.15, zIndex: 0 }}>
                                      <BattleBackgroundIcon car={car} />
                                  </div>
                                  {child.props.children}
                              </div>
                          )
                      });
                  }
                  return React.cloneElement(child, finalProps);
              });
              return <tr className="transition-colors hover:bg-gray-50">{cells}</tr>;
          };

          // --- LÃ“GICA DE GESTIÃ“N ---
          const addCar = () => {
            if (!newCarName.trim()) return;
            const newCar = { id: Date.now(), name: newCarName, detail: '(Nuevo)', color: '#9CA3AF', brandIconType: 'ðŸš—', wins: 0, draws: 0, losses: 0, matches: 0, tier: 2, titles: 0 };
            setCars([...cars, newCar]);
            setNewCarName('');
            setGarageIndex(cars.length); // Ir al nuevo
          };

          const deleteCar = (id) => {
            const newCars = cars.filter(c => c.id !== id);
            setCars(newCars);
            if (garageIndex >= newCars.length) setGarageIndex(Math.max(0, newCars.length - 1));
            if (duel.car1?.id === id || duel.car2?.id === id) resetDuelState();
          };

          const updateCar = (id, field, value) => {
              setCars(cars.map(c => c.id === id ? { ...c, [field]: value } : c));
          };

          const resetDuelState = () => {
            setDuel({ car1: null, car2: null });
            setWinner(null);
            setIsDraw(false);
          };
          
          const startRandomDuel = () => {
            if (cars.length < 2) return;
            resetDuelState();
            let idx1 = Math.floor(Math.random() * cars.length);
            let idx2 = Math.floor(Math.random() * cars.length);
            while (idx1 === idx2) idx2 = Math.floor(Math.random() * cars.length);
            setDuel({ car1: cars[idx1], car2: cars[idx2] });
            setGameMode('free');
            setCupChampion(null); 
          };

          // --- CORE GAME LOOP ---

          // Carga un duelo especÃ­fico. Si no se pasan argumentos, intenta cargar el actual del schedule.
          const loadMatch = (match) => {
             if (!match) return;
             const c1 = cars.find(c => c.id === match.p1Id);
             const c2 = match.p2Id !== 'BYE' ? cars.find(c => c.id === match.p2Id) : { id: 'BYE', name: 'Pase Directo', detail: '', tier: 0, color: '#4F46E5', brandIconType: 'âž¡ï¸' };
             if (c1) {
                 setDuel({ car1: c1, car2: c2 });
                 setWinner(null);
             }
          };

          const loadNextDuelFromSchedule = () => {
              const currentRound = schedule[currentRoundIndex];
              if (!currentRound) return;
              
              // Buscar el primer partido no jugado
              const nextMatchIndex = currentRound.findIndex(m => !m.played);
              
              if (nextMatchIndex !== -1) {
                  setCurrentMatchIndexInRound(nextMatchIndex);
                  loadMatch(currentRound[nextMatchIndex]);
              } else {
                  // Ronda terminada
                  advanceRound();
              }
          };

          const advanceRound = () => {
              if (gameMode === 'league') {
                  // End League
                  const champion = [...cars].sort((a,b) => getPoints(b) - getPoints(a) || a.losses - b.losses)[0];
                  setCars(prev => prev.map(c => c.id === champion.id ? {...c, titles: (c.titles||0)+1} : c));
                  setCupChampion(champion);
                  setGameMode('free');
                  setSchedule([]);
                  resetDuelState();
              } else if (gameMode === 'cup') {
                  generateNextCupRound();
              }
          };

          const generateNextCupRound = () => {
            const currentRound = schedule[currentRoundIndex];
            const winnersIds = currentRound.map(m => m.winnerId).filter(Boolean);

            if (winnersIds.length === 1) {
              // Champion Found
              const champion = cars.find(c => c.id === winnersIds[0]);
              setCars(prev => prev.map(c => c.id === champion.id ? {...c, titles: (c.titles||0)+1} : c));
              setCupChampion(champion);
              setGameMode('free');
              setSchedule([]);
              resetDuelState();
              return;
            }

            const winningCars = winnersIds.map(id => cars.find(c => c.id === id)).filter(Boolean);
            let nextRoundMatches = [];
            let pairs = Math.floor(winningCars.length / 2);
            let roundName = winningCars.length === 8 ? 'Cuartos' : winningCars.length === 4 ? 'Semis' : 'Final';
            if (winningCars.length > 8) roundName = `Ronda ${currentRoundIndex + 2}`;

            for (let i = 0; i < pairs; i++) {
                nextRoundMatches.push({
                    p1Id: winningCars[i].id, p2Id: winningCars[i + pairs].id,
                    p1Name: getFullName(winningCars[i]), p2Name: getFullName(winningCars[i + pairs]),
                    played: false, roundName
                });
            }
            if (winningCars.length % 2 !== 0) {
                const lucky = winningCars[winningCars.length - 1];
                nextRoundMatches.push({
                    p1Id: lucky.id, p2Id: 'BYE', p1Name: getFullName(lucky), p2Name: 'Pase',
                    played: true, winnerId: lucky.id, result: 'Pase', roundName
                });
            }

            // CRITICAL FIX: Update schedule AND load next match explicitly using the NEW data
            const newSchedule = [...schedule, nextRoundMatches];
            setSchedule(newSchedule);
            const newRoundIndex = currentRoundIndex + 1;
            setCurrentRoundIndex(newRoundIndex);
            setCurrentMatchIndexInRound(0);

            // Find first playable of the NEW round
            const firstMatch = newSchedule[newRoundIndex].find(m => !m.played); // Usar newSchedule
            if (firstMatch) {
                loadMatch(firstMatch);
            } else {
                // If all were BYEs (weird), recurse
                resetDuelState();
            }
          };

          const handleResult = (winnerCar, isTie = false) => {
            if (gameMode === 'cup' && isTie) return; 
            setIsDraw(isTie);
            setWinner(isTie ? { name: 'Empate' } : winnerCar);
            
            // Stats Update
            if (gameMode !== 'cup') {
                const c1 = duel.car1, c2 = duel.car2;
                const winnerId = isTie ? null : winnerCar.id;
                const loserId = isTie ? null : (c1.id === winnerId ? c2.id : c1.id);
                
                setCars(prev => prev.map(c => {
                    if (c.id !== c1.id && c.id !== c2.id) return c;
                    if (isTie) return { ...c, draws: c.draws + 1, matches: c.matches + 1 };
                    if (c.id === winnerId) return { ...c, wins: c.wins + 1, matches: c.matches + 1 };
                    if (c.id === loserId) return { ...c, losses: c.losses + 1, matches: c.matches + 1 };
                    return c;
                }));
            }

            // Schedule Update
            if (gameMode !== 'free') {
                const newSchedule = [...schedule];
                const match = newSchedule[currentRoundIndex][currentMatchIndexInRound];
                match.played = true;
                match.result = isTie ? 'Empate' : getFullName(winnerCar);
                match.winnerId = isTie ? null : winnerCar.id;
                setSchedule(newSchedule);
            }
          };

          // --- TOURNAMENT STARTERS ---
          const startLeague = () => {
            if (cars.length < 2) return;
            resetAllStats(false);
            let matches = [];
            for (let i = 0; i < cars.length; i++) {
                for (let j = i + 1; j < cars.length; j++) {
                    matches.push({ p1Id: cars[i].id, p2Id: cars[j].id, p1Name: getFullName(cars[i]), p2Name: getFullName(cars[j]), played: false, roundName: 'Liga' });
                }
            }
            matches.sort(() => Math.random() - 0.5);
            setSchedule([matches]);
            setCurrentRoundIndex(0);
            setCurrentMatchIndexInRound(0);
            setGameMode('league');
            loadMatch(matches[0]);
          };

          const startCup = () => {
            if (cars.length < 2) return;
            resetAllStats(false);
            
            // Logic to power of 2
            let participants = [...cars].sort((a,b) => b.tier - a.tier || Math.random() - 0.5);
            let nextPow2 = 1; 
            while (nextPow2 < participants.length) nextPow2 *= 2;
            
            let rounds = [];
            // Just force byes on top seeds
            const totalSlots = nextPow2;
            const nByes = totalSlots - participants.length;
            
            let round1 = [];
            // Top nByes get BYE
            for(let i=0; i<nByes; i++) {
                const c = participants.shift();
                round1.push({ p1Id: c.id, p2Id: 'BYE', p1Name: getFullName(c), p2Name: 'Pase', played: true, winnerId: c.id, result: 'Pase', roundName: 'Previa/Octavos' });
            }
            // Rest play
            while(participants.length >= 2) {
                const c1 = participants.shift();
                const c2 = participants.pop(); // Match top remaining with bottom
                round1.push({ p1Id: c1.id, p2Id: c2.id, p1Name: getFullName(c1), p2Name: getFullName(c2), played: false, roundName: 'Previa/Octavos' });
            }
            
            round1.sort(() => Math.random() - 0.5);
            setSchedule([round1]);
            setCurrentRoundIndex(0);
            setCurrentMatchIndexInRound(0);
            setGameMode('cup');
            
            // Load first
            const first = round1.find(m => !m.played);
            if(first) loadMatch(first);
            else generateNextCupRound(); // All byes?
          };

          const resetAllStats = (resetTitles) => {
            setCars(prev => prev.map(c => ({ ...c, wins:0, draws:0, losses:0, matches:0, titles: resetTitles?0:c.titles })));
            setSchedule([]); setGameMode('free'); setDuel({ car1:null, car2:null }); setWinner(null); setCupChampion(null);
          };


          // --- VIEWS ---
          const GarageView = () => {
            const car = cars[garageIndex];
            if (!car) return <div className="p-10 text-center">No hay autos.</div>;

            const navigate = (dir) => setGarageIndex((garageIndex + dir + cars.length) % cars.length);

            return (
                <div className="flex flex-col items-center justify-start pt-4 h-full animate-fade-in">
                     {/* Add Input */}
                     <div className="flex gap-2 w-full max-w-sm mb-6 px-4">
                        <input 
                          value={newCarName} onChange={(e) => setNewCarName(e.target.value)}
                          placeholder="Nuevo Auto..." 
                          className="flex-1 border rounded-full px-4 py-2 text-sm shadow-inner"
                          onKeyPress={(e) => e.key === 'Enter' && addCar()}
                        />
                        <button onClick={addCar} className="bg-red-600 text-white p-2 rounded-full shadow hover:bg-red-700 active:scale-95"><Icon name="Plus" size={20}/></button>
                     </div>

                     {/* CARD */}
                     <div className="relative w-full max-w-sm bg-white rounded-3xl shadow-xl border-4 border-white overflow-hidden" style={{borderColor: car.color}}>
                         <div className="absolute top-0 left-0 w-full h-32 opacity-20" style={{backgroundColor: car.color}}></div>
                         
                         <div className="relative pt-8 pb-6 px-6 flex flex-col items-center">
                             {/* Badge */}
                             <div className="w-40 h-40 bg-white rounded-full flex items-center justify-center shadow-lg mb-4 border-4 p-4" style={{borderColor: car.color}}>
                                 <BattleBackgroundIcon car={car} />
                             </div>
                             
                             {/* Name */}
                             <h2 className="text-3xl font-black text-gray-800 text-center uppercase leading-none mb-1">{car.name}</h2>
                             <p className="text-sm text-gray-500 font-medium mb-6">{car.detail}</p>
                             
                             {/* Editors */}
                             <div className="w-full bg-gray-50 rounded-xl p-4 space-y-4">
                                 {/* Color */}
                                 <div className="flex justify-between items-center">
                                     <span className="flex items-center gap-2 text-sm font-bold text-gray-600"><Icon name="Palette" size={16}/> Color</span>
                                     <input type="color" value={car.color} onChange={(e) => updateCar(car.id, 'color', e.target.value)} className="w-8 h-8 rounded-full overflow-hidden border-2 border-white shadow cursor-pointer"/>
                                 </div>
                                 {/* Stars */}
                                 <div className="flex justify-between items-center">
                                     <span className="flex items-center gap-2 text-sm font-bold text-gray-600"><Icon name="Shield" size={16}/> Nivel</span>
                                     <div className="flex">{[1,2,3,4].map(s => <button key={s} onClick={()=>updateCar(car.id,'tier',s)}><Icon name="Star" size={20} className={car.tier >= s ? 'text-yellow-400 fill-yellow-400' : 'text-gray-300'}/></button>)}</div>
                                 </div>
                                 {/* Titles */}
                                 <div className="flex justify-between items-center border-t pt-2">
                                     <span className="flex items-center gap-2 text-sm font-bold text-gray-600"><Icon name="Crown" size={16}/> TÃ­tulos</span>
                                     <span className="text-xl font-black text-yellow-600">{car.titles}</span>
                                 </div>
                             </div>
                         </div>

                         {/* Delete */}
                         <button onClick={() => deleteCar(car.id)} className="absolute top-4 right-4 text-gray-300 hover:text-red-500 p-2"><Icon name="Trash2" size={20}/></button>
                     </div>

                     {/* Nav */}
                     <div className="flex items-center gap-8 mt-6">
                         <button onClick={() => navigate(-1)} className="p-4 bg-white rounded-full shadow-lg text-gray-700 hover:text-red-600 active:scale-90 transition-all"><Icon name="ChevronLeft" size={32}/></button>
                         <span className="font-mono font-bold text-gray-400">{garageIndex + 1} / {cars.length}</span>
                         <button onClick={() => navigate(1)} className="p-4 bg-white rounded-full shadow-lg text-gray-700 hover:text-red-600 active:scale-90 transition-all"><Icon name="ChevronRight" size={32}/></button>
                     </div>
                </div>
            );
          };

          const BracketView = () => {
              if(!schedule.length) return null;
              return (
                  <div className="overflow-x-auto p-4 bg-white rounded-xl shadow-inner mt-4">
                      <div className="flex gap-4">
                          {schedule.map((round, i) => (
                              <div key={i} className="flex flex-col gap-2 min-w-[140px]">
                                  <h4 className="text-xs font-bold text-center uppercase text-red-500 mb-2">{round[0]?.roundName || `Ronda ${i+1}`}</h4>
                                  {round.map((m, j) => {
                                      const isCurrent = i === currentRoundIndex && j === currentMatchIndexInRound;
                                      return (
                                          <div key={j} className={`text-[10px] border rounded p-1 flex flex-col gap-1 ${isCurrent ? 'bg-yellow-50 border-yellow-400 ring-1 ring-yellow-400' : 'bg-gray-50'}`}>
                                              <div className={`flex justify-between ${m.winnerId===m.p1Id?'font-bold text-green-700':''}`}><span>{m.p1Name}</span>{m.winnerId===m.p1Id&&'âœ“'}</div>
                                              <div className="h-px bg-gray-200"></div>
                                              <div className={`flex justify-between ${m.winnerId===m.p2Id?'font-bold text-green-700':''}`}><span>{m.p2Name}</span>{m.winnerId===m.p2Id&&'âœ“'}</div>
                                          </div>
                                      );
                                  })}
                              </div>
                          ))}
                      </div>
                  </div>
              );
          };

          return (
            <div className="min-h-screen bg-gray-100 text-gray-800 font-sans pb-24 md:pb-0">
              <div className="max-w-md mx-auto bg-white min-h-screen shadow-2xl flex flex-col relative">
                
                {/* Header con LOGO GRANDE */}
                <header className="bg-gradient-to-br from-red-600 to-red-800 text-white p-4 shadow-xl sticky top-0 z-30 flex items-center justify-between">
                   <div className="flex items-center gap-3">
                       <div className="bg-white rounded-full p-1 shadow-lg">
                           <img src={ICON_URLS.HOT_WHEELS} alt="HW" className="w-16 h-16 object-contain filter drop-shadow-sm" /> 
                       </div>
                       <div>
                           <h1 className="text-2xl font-black italic tracking-tighter leading-none">TORNEO</h1>
                           <p className="text-xs font-medium opacity-80 tracking-widest">DE AUTITOS</p>
                       </div>
                   </div>
                   {gameMode !== 'free' && <div className="text-xs bg-black/20 px-2 py-1 rounded font-mono">{schedule.flat().filter(m=>m.played).length} PJ</div>}
                </header>

                <main className="flex-1 p-4 overflow-y-auto bg-gray-50">
                  
                  {/* --- GARAGE (AHORA PRESENTACIÃ“N) --- */}
                  {view === 'garage' && <GarageView />}

                  {/* --- ARENA --- */}
                  {view === 'arena' && (
                     <div className="space-y-4 animate-fade-in">
                         {/* Champion Overlay */}
                         {cupChampion && (
                             <div className="bg-gradient-to-b from-yellow-100 to-white border-4 border-yellow-400 p-6 rounded-3xl text-center shadow-2xl mb-6 relative overflow-hidden">
                                <div className="absolute inset-0 bg-yellow-400 opacity-10 animate-pulse"></div>
                                <Icon name="Crown" size={64} className="mx-auto text-yellow-500 mb-2 drop-shadow-md relative z-10" />
                                <h2 className="text-2xl font-black text-yellow-900 relative z-10">Â¡CAMPEÃ“N!</h2>
                                <p className="text-4xl font-black text-gray-800 my-2 relative z-10">{cupChampion.name}</p>
                                <button onClick={() => setCupChampion(null)} className="mt-4 px-6 py-2 bg-yellow-500 text-white font-bold rounded-full shadow hover:bg-yellow-600 relative z-10">Cerrar</button>
                             </div>
                         )}

                         {/* Selector Modes */}
                         {gameMode === 'free' && !duel.car1 && !cupChampion && (
                             <div className="grid grid-cols-2 gap-3 mb-4">
                                <button onClick={startLeague} className="bg-blue-600 text-white p-4 rounded-2xl font-bold shadow-lg hover:bg-blue-700 active:scale-95 flex flex-col items-center gap-1"><Icon name="Award" size={24}/> Iniciar Liga</button>
                                <button onClick={startCup} className="bg-purple-600 text-white p-4 rounded-2xl font-bold shadow-lg hover:bg-purple-700 active:scale-95 flex flex-col items-center gap-1"><Icon name="Crown" size={24}/> Iniciar Copa</button>
                             </div>
                         )}
                         
                         {/* Continue Button */}
                         {gameMode !== 'free' && !duel.car1 && !cupChampion && schedule.length > 0 && (
                             <button onClick={loadNextDuelFromSchedule} className="w-full bg-green-500 text-white p-4 rounded-2xl font-black text-xl shadow-lg hover:bg-green-600 active:scale-95 animate-pulse flex items-center justify-center gap-2">
                                 <Icon name="Play" size={28} fill="currentColor"/> CONTINUAR TORNEO
                             </button>
                         )}

                         {/* BATTLEGROUND */}
                         <div className="bg-slate-900 rounded-3xl p-4 text-white shadow-2xl relative overflow-hidden min-h-[320px] flex flex-col justify-center border-4 border-slate-800">
                             
                             {!duel.car1 ? (
                                 <div className="text-center opacity-40">
                                     <Icon name="Swords" size={64} className="mx-auto mb-2"/>
                                     <p className="font-bold">ESPERANDO DUELO...</p>
                                 </div>
                             ) : (
                                 <div className="flex flex-col gap-3 relative z-10">
                                     {/* Car 1 */}
                                     <button onClick={() => !winner && handleResult(duel.car1)} disabled={!!winner} 
                                        className={`relative group w-full p-3 rounded-2xl border-2 transition-all flex items-center justify-between overflow-hidden ${winner?.id===duel.car1.id ? 'bg-green-600 border-green-400' : 'bg-gray-800 border-gray-700 hover:border-gray-500'}`}>
                                         <div className="absolute inset-0 opacity-20" style={{backgroundColor: duel.car1.color}}></div>
                                         <div className="relative z-10 flex items-center gap-3">
                                             <CarBadge car={duel.car1} size="lg"/>
                                             <div className="text-left">
                                                 <span className="block font-black text-lg leading-none">{duel.car1.name}</span>
                                                 <span className="text-xs opacity-70">{duel.car1.detail}</span>
                                             </div>
                                         </div>
                                         {winner?.id===duel.car1.id && <Icon name="CheckCircle" className="text-white"/>}
                                     </button>
                                     
                                     <div className="flex justify-center items-center gap-2">
                                         <span className="text-red-500 font-black italic text-xl">VS</span>
                                         {!winner && gameMode==='league' && <button onClick={()=>handleResult(null,true)} className="px-3 py-1 bg-gray-700 rounded-full text-xs font-bold hover:bg-gray-600">EMPATE</button>}
                                     </div>

                                     {/* Car 2 */}
                                     <button onClick={() => !winner && handleResult(duel.car2)} disabled={!!winner || duel.car2.id==='BYE'} 
                                        className={`relative group w-full p-3 rounded-2xl border-2 transition-all flex items-center justify-between overflow-hidden ${winner?.id===duel.car2.id ? 'bg-green-600 border-green-400' : 'bg-gray-800 border-gray-700 hover:border-gray-500'}`}>
                                         <div className="absolute inset-0 opacity-20" style={{backgroundColor: duel.car2.color}}></div>
                                         <div className="relative z-10 flex items-center gap-3">
                                             <CarBadge car={duel.car2} size="lg"/>
                                             <div className="text-left">
                                                 <span className="block font-black text-lg leading-none">{duel.car2.name}</span>
                                                 <span className="text-xs opacity-70">{duel.car2.detail || 'AutomÃ¡tico'}</span>
                                             </div>
                                         </div>
                                         {winner?.id===duel.car2.id && <Icon name="CheckCircle" className="text-white"/>}
                                     </button>
                                 </div>
                             )}
                         </div>

                         {/* Controls */}
                         {gameMode !== 'free' && (
                             <button onClick={()=> { if(confirm('Â¿Reiniciar?')) resetAllStats(false); }} className="w-full py-3 text-red-500 text-xs font-bold underline mt-2">REINICIAR TORNEO</button>
                         )}

                         {winner && (
                             <div className="flex gap-2">
                                 {gameMode === 'free' ? (
                                     <button onClick={startRandomDuel} className="flex-1 bg-blue-600 text-white p-4 rounded-xl font-bold shadow-lg active:scale-95 flex justify-center gap-2"><Icon name="Shuffle" /> Otro Amistoso</button>
                                 ) : (
                                     <button onClick={() => loadNextDuelFromSchedule()} className="flex-1 bg-yellow-500 text-white p-4 rounded-xl font-bold shadow-lg active:scale-95 flex justify-center gap-2"><Icon name="Play" size={28} fill="currentColor"/> Siguiente</button>
                                 )}
                             </div>
                         )}
                         
                         {/* Manual Friendly */}
                         {!duel.car1 && gameMode === 'free' && <button onClick={startRandomDuel} className="w-full py-4 bg-gray-200 rounded-xl font-bold text-gray-600 hover:bg-gray-300">Sortear Amistoso</button>}

                         {/* Bracket View */}
                         {gameMode === 'cup' && <BracketView />}
                     </div>
                  )}

                  {/* --- RANKING --- */}
                  {view === 'ranking' && (
                     <div className="animate-fade-in bg-white rounded-2xl shadow p-4 border border-gray-200">
                         <h2 className="font-bold text-gray-700 mb-4 flex items-center gap-2"><Icon name="Award" size={20} className="text-blue-600"/> Tabla de Posiciones</h2>
                         <table className="w-full text-sm">
                             <thead className="text-gray-400 border-b text-xs"><tr><th className="text-left py-2">#</th><th className="text-left py-2">Auto</th><th className="text-center py-2">Pts</th><th className="text-center py-2">PJ</th></tr></thead>
                             <tbody>
                                 {[...cars].sort((a,b)=>getPoints(b)-getPoints(a) || a.losses-b.losses).map((c,i)=>(
                                     <StyledTableRow key={c.id} car={c}>
                                         <td className="py-3 font-bold text-gray-500 w-6">{i+1}</td>
                                         <td className="py-3">
                                             <div className="flex items-center gap-2 font-bold text-gray-800"><CarBadge car={c} size="xs"/> {c.name}</div>
                                             <div className="text-[10px] text-gray-400 pl-8">{c.detail}</div>
                                         </td>
                                         <td className="text-center font-black text-blue-600 text-lg">{getPoints(c)}</td>
                                         <td className="text-center text-gray-400">{c.matches}</td>
                                     </StyledTableRow>
                                 ))}
                             </tbody>
                         </table>
                         <button onClick={()=>resetAllStats(true)} className="mt-4 text-xs text-red-400 underline w-full text-center">Resetear EstadÃ­sticas y TÃ­tulos</button>
                     </div>
                  )}

                </main>

                {/* --- NAVBAR --- */}
                <nav className="bg-white border-t border-gray-200 flex justify-around p-2 pb-6 md:pb-2 sticky bottom-0 z-40">
                   <button onClick={()=>setView('garage')} className={`flex flex-col items-center p-2 rounded-xl transition-all ${view==='garage'?'text-red-600 bg-red-50 font-bold':'text-gray-400'}`}><Icon name="Layers" size={24}/><span className="text-[10px]">Garage</span></button>
                   <button onClick={()=>setView('arena')} className={`flex flex-col items-center p-2 rounded-xl transition-all ${view==='arena'?'text-red-600 bg-red-50 font-bold':'text-gray-400'}`}><Icon name="Swords" size={24}/><span className="text-[10px]">Arena</span></button>
                   <button onClick={()=>setView('ranking')} className={`flex flex-col items-center p-2 rounded-xl transition-all ${view==='ranking'?'text-red-600 bg-red-50 font-bold':'text-gray-400'}`}><Icon name="Award" size={24}/><span className="text-[10px]">Tabla</span></button>
                </nav>

              </div>
            </div>
          );
        }

        // --- RENDER APPLICATION ---
        // Se ejecuta solo despuÃ©s de que todo el DOM y scripts hayan cargado.
        window.onload = function() {
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        };
    </script>
</body>
</html>
